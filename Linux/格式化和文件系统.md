### 格式化

#### 格式化分类

格式化是指对磁盘或磁盘中的分区（partition）进行初始化的一种操作，这种操作通常会导致现有的磁盘或分区中所有的文件被清除。格式化通常分为**低格（低级格式化）和高格（高级格式化）**。

- 低级格式化（Low-Level Formatting）又称低层格式化或物理格式化（Physical Format），对于部分硬盘制造厂商，它也被称为初始化（initialization）。大多数的硬盘制造商将低级格式化（Low-Level Formatting）定义为**创建硬盘扇区使硬盘具备存储能力的操作**。
- 高级格式化又称逻辑格式化，即**创建文件系统的过程**。高格时根据用户选定的文件系统在磁盘的特定区域写入特定数据，以达到初始化磁盘或磁盘分区、清除原磁盘或磁盘分区中所有文件的一个操作。高级格式化包括对主引导记录中分区表相应区域的重写，根据用户选定的文件系统在分区中划出一片用于存放文件分配表、目录表等用于文件管理的磁盘空间以便用户使用该分区管理文件。
- **低格在硬盘出厂时已经完成。如果没有特别指明，对硬盘的格式化通常是指高格**。

在Windows环境下，格式化的操作相对简单。通常的操作步骤是：先打开资源管理器，接着在希望被执行格式化的盘符图标上右击，然后选择“格式化”，再按照提示操作即可。需要注意的是：对硬盘执行格式化操作时，用户需要拥有系统管理员权限（仅限于 Windows Vista 以及此后推出的作业系统。）在 Windows 环境中，除了可以使用图形化的操作界面执行格式化操作之外，也可以在命令提示字符中使用 `Diskpart 指令`（仅限于Windows 2000 及以后的作业系统，包含 Windows PE）进行操作。

在Unix/Linux环境下，通常使用 `mkfs 命令` 执行格式化操作，mkfs 命令需要的参数有设备路径和文件系统格式等。需要注意的是：对硬盘执行格式化操作时，用户需要拥有超级用户权限。

### 文件系统

分区建立后，必须格式化为文件系统才能用来存储数据 。

**文件系统（File System）**是操作系统中负责管理和存储文件信息的软件机构，用于向用户提供底层数据访问。它将设备中的空间划分为特定大小的块（或称为簇），一般每块 512 字节，一个块可能由多个扇区组成。数据存储在这些块中，大小被修正为占用整数个块，由文件系统软件来负责将这些块组织为文件和树形目录，并记录哪些块被分配给了哪个文件，以及哪些块没有被使用。文件系统使用文件和树形目录的抽象逻辑概念代替了硬盘和光盘等物理设备实际使用数据块的概念，用户使用文件系统来保存数据时不必关心数据实际保存在硬盘（或者光盘）的地址为多少的数据块上，只需要记住这个文件的所属目录和文件名。

文件系统是数据的组织者和提供者，并不一定只在特定存储设备上出现，实际上文件系统可能仅仅是一种访问数据的界面而已，实际的数据是通过网络协议（如NFS、SMB、9P等）提供的或者在内存上，甚至可能根本没有对应的文件（如 PROC 文件系统）。严格地说，文件系统是一套实现了数据的存储、分级组织、访问和获取等操作的抽象数据类型（Abstract data type）。

生活中我们所说的磁盘格式就是指文件系统。不同的操作系统所使用的文件系统也不同。

#### Microsoft 系统支持的文件系统

| Windows                                  | FAT12/FAT16 | FAT32/VFAT | FAT64/exFAT | NTFS  |
| ---------------------------------------- | ----------- | ---------- | ----------- | ----- |
| Windows 3.x或更早（MS-DOS 6.22）（PC-DOS 7.0）  | 可读/可写       | 不支持        | 不支持         | 不支持   |
| 95                                       | 可读/可写       | 不支持        | 不支持         | 不支持   |
| 95（OSR2以后）98（含SE）ME                      | 可读/可写       | 可读/可写      | 不支持         | 不支持   |
| NT                                       | 可读/可写       | 不支持        | 不支持         | 可读/可写 |
| 2000XPVistaServer 2003Server 2008 (R2)78Server 2012 (R2)8.110 | 可读/可写       | 可读/可写      | 可读/可写       | 可读/可写 |

> 注意：除非NT安装了FAT32 For Windows NT 4.0，否则 NT 是不支持 FAT32。

##### FAT16

对电脑老手而言，对这种硬盘分区格式是最熟悉不过了它采用 16 位的文件分配表，能支持的最大分区为 2 GB，是曾经应用最为广泛和获得操作系统支持最多的一种磁盘分区格式，几乎所有的操作系统都支持这一种格式，从 DOS、Win 3.x、Win 95、Win 97到Win 98、Windows NT、Windows 2000、Windows XP 以及 Windows Vista和 Windows 7 的非系统分区，一些流行的 Linux 都支持这种分区格式。

但是 FAT16 分区格式有一个最大的缺点，那就是硬盘的实际利用效率低。因为在 DOS 和 Windows 系统中，磁盘文件的分配是以簇为单位的，一个簇只分配给一个文件使用，不管这个文件占用整个簇容量的多少。而且每簇的大小由硬盘分区的大小来决定，分区越大，簇就越大。例如 1GB 的硬盘若只分一个区，那么簇的大小是 32 KB，也就是说，即使一个文件只有 1 字节长，存储时也要占 32 KB 的硬盘空间，剩余的空间便全部闲置在那里，这样就导致了磁盘空间的极大浪费。FAT16 支持的分区越大，磁盘上每个簇的容量也越大，造成的浪费也越大。所以随着当前主流硬盘的容量越来越大，这种缺点变得越来越突出。为了克服 FAT16 的这个弱点，微软公司在 Windows 97 操作系统中推出了一种全新的磁盘分区格式 FAT32。

##### FAT32

这种格式采用 32 位的文件分配表，使其对磁盘的管理能力大大增强，突破了 FAT16 对每一个分区的容量只有 2GB 的限制，可以支持的磁盘大小达到 32 GB，但是不能支持小于 512 MB 的分区。运用 FAT32 的分区格式后，用户可以将一个大硬盘定义成一个分区，而不必分为几个分区使用，大大方便了对硬盘的管理工作。而且，FAT32 还具有一个最大的优点是：在一个不超过 8GB 的分区中，FAT32 分区格式的每个簇容量都固定为 4KB，与 FAT16 相比，可以大大地减少硬盘空间的浪费，提高了硬盘利用效率，但是，FAT32 的单个文件不能超过4G。

**有时候我们往优盘（或内存卡）中复制的文件大小明明小于优盘的可用空间大小，系统却提示存储空间不足，这个时候突然发现我们的优盘是 FAT32 格式，而我们所传的单个文件也超过了 4 GB。这个时候可以将优盘格式化为 NTFS 格式即可。使用 Windows 系统格式化时可以选择“快速格式化’”，前提是磁盘没有损坏。**

**多数 Android 系统手机仅支持 FAT32 格式的存储设备。有时候给手机插上 OTG 优盘（或内存卡）后提示格式化为便携式存储设备，可能并不我们的优盘损坏了，而是其格式不是 FAT32。但如果我们不想将优盘格式化为 FAT32 怎么办呢？手机上安装一个 ES 文件浏览器打开 OTG 优盘即可。其实，某些国产 Android  定制系统中，像 Flyme 和 EMUI 这些系统已经解决了这个问题 ，系统完全支持除 FAST32 外的 NTFS 和 exFAT 等格式**。

支持这一磁盘分区格式的桌面操作系统有 Windows 97/98/2000/XP/Vista/7/8 等。但是，这种分区格式也有它的缺点，首先是采用 FAT32 格式分区的磁盘，由于文件分配表的扩大，运行速度比采用 FAT16 格式分区的硬盘要慢；另外，由于 DOS 系统和某些早期的应用软件不支持这种分区格式，所以采用这种分区格式后，就无法再使用老的 DOS 操作系统和某些旧的应用软件了。

##### NTFS

NTFS 是一种新兴的磁盘格式，目前广泛应用于 Win Vista、Win 7、Win 8、Win 10 操作系统中。早期用在 Windows NT 网络操作系统中，但随着安全性的提高，在 Windows Vista 和 Windows 7 操作系统中也开始使用这种格式。其显著的优点是安全性和稳定性极其出色，在使用中不易产生文件碎片，对硬盘的空间利用及软件的运行速度都有好处。而且**单个文件可以超过 4 GB**。它能对用户的操作进行日志记录，通过对用户权限进行非常严格的限制，使每个用户只能按照系统赋予的权限进行操作，充分保护了网络系统与数据的安全。

##### exFAT

exFAT（全称Extended File Allocation Table File System，扩展 FAT，即扩展文件分配表）是 Microsoft 在Windows Embeded 6.0（包括 Windows CE 6.0、Windows Mobile）中引入的一种适合于闪存的文件系统。对于闪存设备（比如优盘和内存卡），NTFS 过于复杂，exFAT 更为适用。

相对FAT文件系统，exFAT 有如下好处：

- 增强了台式电脑与移动设备的互操作能力；
- 单文件大小最大可达 16 EB（1 EB = 1024 PB，1 PB = 1024 TB）；
- 簇大小可高达 32 MB；
- 采用了剩余空间分配表，剩余空间分配性能改进；
- 同一目录下最大文件数可达 65536 个；
- 支持访问控制；
- 支持 TFAT。

> 请注意：exFAT只是一个折中的方案，只为U盘而生。采用该文件系统的闪存盘不支持 Windows Vista ReadyBoost。Windows Vista SP1 开始支持该文件系统。需要严格注意的是，Win Vista 以前系统并不支持这种格式，Win XP 可以通过替换驱动文件的方式支持此格式，但是只能读写，不能格式化。

#### Linux 系统支持的文件系统

##### ext2

ext2 是 GNU/Linux 系统中标准的文件系统。它是专门为 Linux 设计的，拥有极快的速度和极小的 CPU 占用率。ext2 既可以用于标准的块设备（如硬盘），也被应用在软盘等移动存储设备上。

##### ext3

ext3 是 ext2 的下一代，也就是保有 ext2 的格式之下再加上日志功能。ext3 是一种日志式文件系统（Journal File System)，最大的特点是它会将整个磁盘的写入动作完整的记录在磁盘的某个区域上，以便有需要时回溯追踪。当在某个过程中断时，系统可以根据这些记录直接回溯并重整被中断的部分，重整速度相当快。该分区格式被广泛应用在 Linux 系统中。

##### Linux swap

它是 Linux 中一种专门用于交换分区 swap 的文件系统。Linux 使用这一整个分区作为交换空间。一般这个swap格式的交换分区是物理内存的 2 倍，在内存不够时，Linux 会将部分数据写到交换分区上。

##### VFAT

VFAT 叫长文件名系统，这是一个**与 Windows 系统兼容的 Linux 文件系统，支持长文件名，可以作为 Windows 与 Linux 交换文件的分区**。

##### ext4

ext4 是一种针对 ext3 系统的扩展日志式文件系统，是专门为 Linux 开发的原始的扩展文件系统（ext 或 extfs）的第四版。 Linux kernel 自 2.6.28 开始正式支持新的文件系统 ext4 。 ext4 是 ext3 的改进版，修改了 ext3 中部分重要的数据结构，而不仅仅像 ext3对 ext2 那样，只是增加了一个日志功能而已。ext4 可以提供更佳的性能和可靠性，还有更为丰富的功能。

随着 Linux 的不断发展，它所支持的文件格式系统也在迅速扩充，Linux 系统核心可以支持十多种文件系统类型：Btrfs、JFS、ReiserFS、exFAT、EXT、EXT2、EXT3、EXT4、XFS、ISO 9660、XFS、Minx、MSDOS、UMSDOS、VFAT、NTFS、HPFS、NFS、SMB、SysV、PROC等。

> 注意：部分 Linux 发行版默认不支持 NTFS 文件系统，解决方法是安装 NTFS-3G 或 ufsd 等 NTFS 驱动程序。部分 Linux 发行版对 NTFS 的支持度并不高。

#### 常见文件系统的比较

| FS Name   | Year Introduced | Original OS | Max File Size | Max FS Size  | Journaling |
| --------- | --------------- | ----------- | ------------- | ------------ | ---------- |
| FAT16     | 1983            | MSDOS V2    | 4GB           | 16MB to 8GB  | N          |
| FAT32     | 1997            | Windows 95  | 4GB           | 8GB to 2TB   | N          |
| HPFS      | 1988            | OS/2        | 4GB           | 2TB          | N          |
| NTFS      | 1993            | Windows NT  | 16EB          | 16EB         | Y          |
| HFS+      | 1998            | Mac OS      | 8EB           | ?            | N          |
| UFS2      | 2002            | FreeBSD     | 512GB to 32PB | 1YB          | N          |
| ext2      | 1993            | Linux       | 16GB to 2TB4  | 2TB to 32TB  | N          |
| ext3      | 1999            | Linux       | 16GB to 2TB4  | 2TB to 32TB  | Y          |
| ReiserFS3 | 2001            | Linux       | 8TB8          | 16TB         | Y          |
| ReiserFS4 | 2005            | Linux       | ?             | ?            | Y          |
| XFS       | 1994            | IRIX        | 9EB           | 9EB          | Y          |
| JFS       | ?               | AIX         | 8EB           | 512TB to 4PB | Y          |
| VxFS      | 1991            | SVR4.0      | 16EB          | ?            | Y          |
| ZFS       | 2004            | Solaris 10  | 1YB           | 16EB         | N          |