---
typora-copy-images-to: ..\..\graphs\photos
typora-root-url: ./
---

全新硬盘装系统之前，必须对其进行分区，硬盘分区初始化的格式主要有两种：传统的 MBR（[Master Boot Record](https://en.wikipedia.org/wiki/Master_boot_record) ，即主引导记录）  和新的 GPT（ [GUID Partition Table](https://wiki.archlinux.org/index.php/GUID_Partition_Table)）。后者功能更强大，解决了 MBR 的许多限制。

### MBR

MBR 早在 1983 年 IBM PC DOS 2.0 中就已经提出。之所以叫“主引导记录”，是因为它位于驱动器开始部分的主引导扇区，是硬盘的第一扇区。它由三个部分组成：Boot loader、硬盘分区表 DPT 和结束标志字。

![201610170953378340](../../graphs/photos/201610170953378340.png)

- 第一部分为Boot loader，位于主引导扇区的前 446 个字节，偏移地址为 0000H--0088H，是一小段代码，用于加载硬盘上其他分区上更大的加载器（如操作系统的启动加载器）。如果你安装了 Windows，Windows 启动加载器的初始信息就放在这个区域里。如果 MBR 的信息被覆盖导致 Windows不能启动，你就需要使用启动优盘中 DiskGenius 软件提供的重建 MBR 功能来使其恢复正常。如果你安装了 Linux，则这里通常存储的是 GRUB 启动加载器的初始信息。该区域主要提供以下三个功能：
  - 提供启动引导菜单：使用者可以在该菜单中选择启动不同的开机项。在系统未加载前按下主板[快速启动的快捷键]()就可以看到该菜单；
  - 指向开机所需的核心文件来启动操作系统；
  - 还可将开机引导权交给其它 loader。每个分区也拥有自己的启动扇区（Boot sector），开机引导程序除了可以装在这里外，还可装在各分区的启动扇区。
- 第二部分为Disk partition table 区（DPT分区表），占 64 个字节，偏移地址为01BEH--01FDH，记录整个磁盘分区的状态，每 16 个字节标记一个分区，因此最多可记录 4 个分区。**分区的单位是柱面**，每个 16 字节的记录区记录了该分区从开始到结束的柱面号。所谓的分区操作即是对分区表进行设置，当文件系统要写入磁盘时，首先会参考分区表。在 MBR 分区表中，逻辑块地址采用 32 位二进制数表示，因此一共可表示 2 的 32 次方个逻辑块地址，所以，MBR 硬盘最大分区容量仅为 2.2 TB = 2^32 × 512 bytes；
- 第三部分是结束标志字，占 2 个字节，偏移地址为01FEH--01FFH。固定为55AA，是检验主引导记录是否有效的标志。该标志错误将导致系统不能启动。

上面所说的分区为主分区（primary partition）或扩展分区（extend partition）。**一个磁盘或者 RAID 卷上只能有 4 个可启动的主分区**。如果 MBR 分区方案需要使用 4 个以上的分区，那就需将至少一个主分区设置为扩展分区，然后在该扩展分区上面建立若干个逻辑分区（logic partition）。扩展分区可以被看作是容纳逻辑分区的容器。**硬盘上最多只能有 1 个扩展分区（操作系统的限制）且其本身不能格式化，必须划分逻辑分区后才能使用，但扩展分区中的逻辑分区没有数量限制**。扩展分区也被看作是一个主分区，因此，在存在扩展分区的情况下最多只能再建 3 个主分区（3 个主分区加 1 个可包含多个逻辑分区的扩展分区）。

扩展分区中逻辑驱动器的引导记录是链式的。每一个逻辑分区都有一个和 MBR 结构类似的扩展引导记录（EBR），其分区表的第一项指向该逻辑分区本身的引导扇区，第二项指向下一个逻辑驱动器的 EBR，分区表第三、第四项没有用到。Windows 系统默认情况下，一般都是只划分一个主分区给系统，剩余的部分全部划入扩展分区。在Linux系统中，硬盘分区命名为 sda1－sda4 或者 hda1－hda4（其中 a 表示硬盘编号可能是a、b、c等等）。在 MBR 硬盘中，分区号 1－4 是主分区（或者扩展分区），逻辑分区号只能从 5 开始。通常习惯是创建主分区 sda1 到 sda3，然后建立一个扩展分区 sda4。sda4 中包含 sda5，sda6 等逻辑分区。

### BIOS

**BIOS**（Basic Input Output System）即**基本输入输出系统** ，它是个人电脑启动时加载的第一个软件。其实，它是一个存储在计算机内主板BOIS芯片上的程序，它保存着计算机最重要的基本输入输出的程序、加电自检程序（Power On Self Test，简称POST自检）和系统启动程序等。

一般在计算机启动时按F2或者Delete即可进入BIOS程序进行设置（一些特殊机型按F1、Esc、F12等进行设置）。 其主要功能是为计算机提供最底层的、最直接的硬件设置和控制。

### UEFI

**UEFI**的全称是**Unified Extensible Firmware Interface**，意即**统一可扩展固件接口**，它是基于 EFI 1.10 标准为基础发展而来，值得注意的是在 UEFI 正式确立之前，Intel 就开始积极推进传统 BIOS 的升级方案，并最终确立了过渡方案 EFI 标准，直到 2007 年 Intel 将 EFI 标准的改进与完善工作交给 Unified EFI Form 进行全权负责，EFI 标准则正式更名为 UEFI。

相比传统BIOS，UEFI的一些优点在于：

1.  高效开发。BIOS开发一般采用汇编语言，代码多是硬件相关的代码。而在UEFI中，绝大部分代码采用C语言编写，UEFI应用程序和驱动甚至可以使用C++编写。UEFI通过固件——操作系统接口（BS和RT服务）为OS和OS加载器屏蔽了底层硬件细节，使得UEFI上层应用可以方便重用。
2.  可扩展性。UEFI的模块化设计在逻辑上分为硬件控制与OS（操作系统）软件管理两部分，硬件控制为所有UEFI版本所共有，而OS软件管理其实是一个可编程的开放接口。借助这个接口，主板厂商可以实现各种丰富的功能。比如我们熟悉的各种备份及诊断功能可通过UEFI加以实现，主板或固件厂商可以将它们作为自身产品的一大卖点。UEFI也提供了强大的联网功能，其他用户可以对你的主机进行可靠的远程故障诊断，而这一切并不需要进入操作系统。
3.  **缩短启动和休眠恢复时间**。UEFI可运行于32位或64位模式，突破了传统16位代码的寻址能力，达到处理器的最大寻址，此举克服了BIOS代码运行缓慢的弊端。
4.  **启动的安全性**。当系统的安全启动功能被打开后，UEFI在执行应用程序和驱动前会先检测程序和驱动的证书，仅当证书被信任时才会执行这个应用程序或驱动。UEFI应用程序和驱动采用PE/COFF格式，其签名放在签名块中。
5.  **更大的磁盘容量和分区数量**。传统MBR分区最大只能支持2.2TB的硬盘和4个主分区，而UEFI规范之一的GPT分区格式，则可以支持过百TB大小的硬盘和100个主分区。
6.  兼容性。与BIOS不同的是，UEFI体系的驱动并不是由直接运行在CPU上的代码组成的，而是用EFI Byte Code（EFI字节代码）编写而成的。EFI Byte Code是一组类似于Java类文件的虚拟机器指令，必须在UEFI驱动运行环境下被解释运行，由此保证了充分的向下兼容性。
7.  **鼠标操作**。UEFI内置图形驱动功能，可以提供一个高分辨率的彩色图形环境，用户进入后能用鼠标点击调整配置，一切就像操作Windows系统下的应用软件一样简单。

相比传统的BIOS，UEFI还提供了文件系统的支持，它**能够直接读取FAT、FAT32分区中的文件**，例如华硕、华擎等主板在UEFI BIOS环境下更新BIOS就**可以直接读取U盘中的BIOS及其他文件**，另外**新的UEFI主板基本都提供了截屏功能，这些截屏图片都可以存储在U盘当中**。

**UEFI还有一个重要特性就是在UEFI下运行应用程序，这类程序文件通常以efi结尾。利用UEFI可以直接识别FAT分区中的文件，又可直接在其中运行应用程序**。我们就可以将Windows安装程序做成efi类型应用程序，然后把它放到任意FAT分区中直接运行即可。

当然由于UEFI主要由高级语言编写（C语言），相比于传统BIOS的汇编语言，UEFI BIOS在安全防护性方面相比传统BIOS要弱，比较容易遭到病毒的攻击，安全性有待进一步提升。不过在图形化界面、应用程序扩展面前，UEFI BIOS还是非常成功的。

主板为了兼容MBR分区表，一般会提供Legacy BIOS和UEFI BIOS启动模式选项，如果要使用UEFI模式安装Windows，就必须开启UEFI启动模式。

目前64bit Windows Vista、7、8、8.1、10都已经支持GPT分区表，而Windows 8、8.1、10都已经原生支持UEFI，安装这些系统的时候：只要硬盘设置为GPT分区表 主板设置为UEFI启动后，就可以直接开始安装操作系统了。自Win8发布以来，新出厂的预装Win8/Win8.1的电脑都默认在UEFI模式下启动操作系统。

而对于Windows Vista、7系统，就需要手动添加UEFI支持，我们可以找一份Windows 8或者10安装镜像，从安装文件中提取Bootmgfw.efi文件，重命名为BOOTX64.EFI，拷贝到win7安装文件的\EFI\Boot\下，如果没有BOOT文件夹就新建一个。

### GPT

GPT 的全称是 Globally Unique Identifier Partition Table，意即 [GUID 分区表](http://www.jinbuguo.com/storage/gpt.html)，它的推出是和 [UEFI](https://wiki.archlinux.org/index.php/Unified_Extensible_Firmware_Interface) （相辅相成的。GPT 和 UEFI 相相辅助相成，UEFI 将逐渐取代 ，而 GPT 也将逐渐取代 MBR。UEFI和GPT是相辅相成的，二者缺一不可，要想使用GPT分区表则必须是UEFI BIOS环境。

与支持最大 **2T** 磁盘和RAID卷且至多有 4 个主分区的 MBR 分区表相比， **GPT 分区表**能支持最大 18 EB（Exabytes）磁盘和 RAID 卷。并且磁盘和 RAID 卷的分区数没有上限，只受到操作系统限制（由于分区表本身需要占用一定空间，最初规划硬盘分区时，留给分区表的空间决定了最多可以有多少个分区）。比如，在Windows系统上，由于系统的限制 GPT 最多只能支持 128个 磁盘分区，基本可以满足所有用户的存储需求。在每一个分区上，这个标识符是一个随机生成的字符串，可以保证为地球上的每一个 GPT 分区都分配完全唯一的标识符。



![201610170953379290_看图王](../../graphs/photos/201610170953379290_看图王-9799511705.jpg)

在安全性方面，GPT分区表也进行了全方位改进。在早期的MBR磁盘上，分区和启动信息是保存在一起的。如果这部分数据被覆盖或破坏，事情就麻烦了。相对的，GPT在整个磁盘上保存多个这部分信息的副本，因此它更为健壮，并可以恢复被破坏的这部分信息。GPT还为这些信息保存了循环冗余校验码（CRC）以保证其完整和正确——如果数据被破坏，GPT会发觉这些破坏，并从磁盘上的其他地方进行恢复。

### 选择 MBR 还是 GPT？

GPT 相对于诞生于 MS-DOS 时代的 MBR 而言，有许多优点。在做出选择前，需要考虑如下内容：

- **如果使用 GRUB legacy 作为 bootloader，必须使用 MBR**。
- **如果使用传统的BIOS，并且双启动中包含 Windows （无论是 32 位版还是 64位 版），必须使用 MBR**。
- **如果使用 UEFI 而不是BIOS，并且双启动中包含 Windows 64 位版，必须使用 GPT**。
- 非常老的机器需要使用 MBR，因为 BIOS 可能不支持 GPT.
- 如果不属于上述任何一种情况，可以随意选择使用 GPT 还是 MBR。由于 GPT 更先进，建议选择 GPT。
- 建议在使用 UEFI 的情况下选择 GPT，因为有些 UEFI firmware 不支持从 MBR 启动。
- 为了使 GRUB 从一台有 GPT 分区的基于 BIOS 的系统上启动，需要创建一个 BIOS 启动分区, 这个分区和 /boot 没关系，仅仅是 GRUB 使用，不要建立文件系统和挂载。


以下为主流操作系统对 GPT 的支持情况列表。

![Cg-4zFTdcXWIU7ABAAWGKozbRYUAAUsRQLKPWsABYZC801](../../graphs/photos/Cg-4zFTdcXWIU7ABAAWGKozbRYUAAUsRQLKPWsABYZC801.jpg)

更详细的支持列表可参考[维基百科](https://zh.wikipedia.org/wiki/GUID%E7%A3%81%E7%A2%9F%E5%88%86%E5%89%B2%E8%A1%A8#.E6.93.8D.E4.BD.9C.E7.B3.BB.E7.BB.9F.E6.94.AF.E6.8C.81)。

对于新平台用户（Intel 6系以后/AMD 900系列以后和A系列）来说，都强烈推荐使用 GPT 分区表格式，目前包括 Win Vista、Win7、Win8、Win8.1、Win10 已经都支持读取和使用 GPT 分区表。而对于使用 Win8、Win8.1、Win10 的用户，换用 GPT 后开机启动速度也可以进一步得到显著提升。

### 安装系统时选择引导方式和分区格式

#### 查看系统引导方式

由于现在刚出的新电脑基本都是 UEFI + GPT 的，如果要更换系统就必须按照 GPT 分区格式 + UEFI 引导的方式去安装。但如果想使用以前的 MBR 方式去安装（比如安装 Ghost 系统）那就只能将转换硬盘的分区格式转换为 MBR 、修改系统引导方式为 Legacy、重新分区再安装。

**如果在分区格式为 MBR 的硬盘上安装较新的 Windows 系统时忘了把之前 MBR 分区格式改为 GPT，然后在选择 Windows 安装位置时不能继续**，如下图所示。

![1306Windows-8-2013-06-08-20-13-39](../../graphs/photos/1306Windows-8-2013-06-08-20-13-39.png)

这个时候就需要将硬盘分区格式修改为 GPT，修改系统引导方式为 UEFI、重新分区再安装。Windows启动方式是什么，是UEFI还是BIOS呢？为了方便后来人查看，这里总结三个适用于[Win10](http://win10.ithome.com/)、[Win8.1](http://win8.ithome.com/)、[Win8](http://www.win8china.com/)、[Win7](http://www.win7china.com/)、Vista的方法：

**最装X方法：**

在安装操作系统时，安装程序会收集一些必备信息，电脑的启动方式就是其中之一。在你的电脑C:\Windows\Panther文件夹中找到setupact.log文件，用记事本打开，然后搜索Detected Boot Environment，在这里你就可以看到系统启动方式了。

![UEFI还是Legacy BIOS？如何确定Windows启动类型](https://img.ithome.com/newsuploadfiles/2015/5/20150508_141525_232.jpg)

当朋友看见你从这个几十MB的log文档中找到这一行文字时，那可真是太装X了。

**最智慧方法：**

如果你知晓GPT与UEFI启动之间的关系，那么你可能知道，Windows想要从GPT硬盘引导，就必须以UEFI方式启动（反之则不成立）。在磁盘管理中看一下硬盘类型，如果是GPT，那么电脑肯定就是UEFI启动了。打开磁盘管理，在主硬盘上右键单击，如果出现“转换成GPT磁盘”，那说明硬盘为MBR类型；如果出现“转换成MBR磁盘”则说明硬盘为GPT类型（因为是主硬盘，这一项是灰色不可用状态）。

![UEFI还是Legacy BIOS？如何确定Windows启动类型](https://img.ithome.com/newsuploadfiles/2015/5/20150508_141539_737.jpg)

**高手用这个方法：**

注：该方法适用于Win8及更高版本系统。

按Win+R打开运行，输入msinfo32，回车查看系统信息。在BIOS模式中如果显示“传统”，表示系统启动方式为Legacy BIOS；如果为UEFI，则显示UEFI。

![UEFI还是Legacy BIOS？如何确定Windows启动类型](https://img.ithome.com/newsuploadfiles/2015/5/20150508_141600_274.jpg)

#### 修改系统引导方式

在系统开始加载前按下热键（一般为Del、F2等）进入BIOS。一般该功能一般位于启动相关的菜单下，不同主板的电脑操作方式大同小异。如下图所示，可以修改系统的引导方式。

![20160512_172140_341](../../graphs/photos/20160512_172140_341.png)

> 注意：UEFI 引导方式需要主板芯片组支持，如果你在 BIOS 设定中没有找到相应内容，那么很可能就是你的主板没有此功能。一般近些年的新主板都支持 UEFI。

> 不同电脑的快捷启动键有所不同，可以参考这里查看常见主板和笔记本的快捷启动键表。

#### 安装系统时设置硬盘分区

##### **通过安装Windows时的diskpart工具**

1. 安装系统时在系统版本选择界面按下 `Shift+F10` 快捷键调出命令提示符，如下图所示：

   ![20160512_172343_387](../../graphs/photos/20160512_172343_387.png)

2. 输入 [`diskpart`](https://technet.microsoft.com/zh-cn/library/cc766465(v=ws.10).aspx) 命令后按回车键，进入 DISKPART 工具，如下图所示。

3. 输入 `list disk` 命令后按回车键，查看电脑当前可用硬盘，编号为0、1、2。。。，如果你只有一块硬盘，则只有0号磁盘；有两块硬盘，则还会显示1号磁盘，以此类推，如下图所示。


4. 输入 `select disk x`（`x` 为上述硬盘编号），选择你要进行分区操作的硬盘，如果只有一块硬盘，输入`select disk 0` 后按回车键即可，如下图所示。

![20160512_172423_739](../../graphs/photos/20160512_172423_739.png)

5. 执行 `clean` 命令清除该硬盘上的所有分区（记得备份数据，新硬盘无需此步骤），此时会清除所有硬盘数据，如下图所示。
6. 如果是按照 GPT 分区格式安装操作系统，则执行 `convert gpt` 命令将该硬盘转换成 GPT 分区格式，如下图所示。

![20160512_172707_714](../../graphs/photos/20160512_172707_714.png)

   > 当然，如果是按 MBR 分区格式安装系统，也可以创建 MBR 分区格式，使用 `convert mbr` 命令即可。 

7. 创建 EFI 分区，执行 `create partition efi size=200`（分区大小为 200 MB），如下图所示。

> EFI 系统分区，即 EFI system partition，简写为 ESP。ESP 是一个 FAT16 或 FAT32 格式的物理分区，但是其分区标识是 EF (十六进制) 而非常规的 0E 或 0C，因此，该分区在 Windows 操作系统下一般是不可见的。支持 EFI 模式的电脑需要从 ESP 启动系统，EFI 固件可从 ESP 加载 EFI 启动程序或者应用。
>
> **仅当使用UEFI模式以及GPT分区表的时候需要EFI系统分区（又称ESP），对于GPT分区表，EFI分区是必需的，它用来存放操作系统的引导器（loader），而MSR不是必需的，仅当使用Windows系统时才需要MSR保留分区**。

8. 创建 MSR 分区，执行 `create partition msr size=200`（微软系统保留分区），如下图所示。

> **MSR分区（Microsoft Reserved Partition，缩写MSR）即 Microsoft 保留（MSR）分区，是每个在 GUID 分区表上的 Windows 操作系统（Win 7 及以上）都要求的分区**。系统组件可以将 MSR 分区的部分分配到新的分区以供它们使用。
>
> MSR 分区的大小会因 GPT 磁盘的大小不同而发生变化。对于小于 16 GB 的磁盘，MSR 分区为 32 MB。**对于大于 16 GB 的磁盘，MSR 分区为 128 MB。MSR 分区在“磁盘管理”中不可见，用户也无法在 MSR 分区上存储或删除数据**。
>
> **对于在GPT磁盘上的Windows操作系统，MSR分区是必须保留的，不可删除（无法启动可能是由于用part1，part2…等表示的分区因为MSR分区的删除而改变导致的）。而对于GPT磁盘中的其他操作系统，如Linux、Mac等则不受影响**。
>
> 可以使用命令：`create partition msr [size=<n>][offset=] [noerr]` 创建 MSR 分区，单位为 MB。
>
> 用 Win8 系统安装版分区时，系统自动划分出“分区1、2、3”，它们是 Win 8 的特有分区。其中 300 MB 为恢复区，100 MB 为系统分区，128 MB 为 MSR 分区。

9. 创建主分区，执行 `create partition primary size=xxx`（单位为MB，具体大小根据你的要求而定）（创建结束后，可执行active命令设置活动分区，然后可顺便执行format quick进行快速格式化。在MBR格式下，若要创建扩展分区，则执行：`create partition extended size=n` ，如果你不需要建立其他主分区，可把剩余空间全部划分为扩展分区。在扩展分区中创建逻辑分区，则执行：`create partition logical size=n` 。可建立多个逻辑分区，总容量要小于等于扩展分区，但最好等于扩展分区大小，以免浪费空间。也可以在每个逻辑分区创建完毕后顺便执行format quick，进行快速格式化。分区结束后，如果忘记格式化，可执行select partition x，然后为该分区执行format quick速格式化）。
10. 再次输入 `list disk` 命令后按回车键可查看已建立的分区列表。如下图所示。

![20160512_172628_875](../../graphs/photos/20160512_172628_875.png)

> 注意：这里系统安装过程采用虚拟机模拟，模拟硬盘为 60 GB，因此主分区大小设定 30 GB 仅作为操作演示。
>
> 可在进入 DISKPART 工具后输入 help 查看有关 [diskpart](https://technet.microsoft.com/zh-cn/library/cc766465(v=ws.10).aspx) 命令的详细信息。

10. 如果还有剩余空间，可继续重复执行上述命令来创建新的分区（注意修改具体数值）。但**建议用户创建完系统分区后就退出命令提示符（输入 exit 后回车）继续安装系统**，毕竟这种方式不容易估算剩下的硬盘空间大小，进入安装位置选择界面后可以进一步划分剩余空间，如下图所示。也可以在安装后，进入系统磁盘管理中进行分配。

![20160512_173005_16](../../graphs/photos/20160512_173005_16.png)

**这种的方法不需要任何第三方工具，属于最基本方法。好处就在于操作简便直观，缺点在于命令不好记，整个硬盘需要全部格式，数据无法保留**。所以，在操作之前，务必对于硬盘上的重要数据提前备份到其他存储设备上。

##### 使用Win7/Win8.1/Win10安装程序自带的分区工具

1. 使用原版系统安装盘（非 Ghost 版）引导电脑。
2. 以未分区硬盘为例，选中未分配空间（SSD + HDD 用户需要按照容量区分好目标硬盘），点击“新建”，如下图 所示。

![20161101_141513_121](../../graphs/photos/20161101_141513_121.jpg)

3. 给出分区大小，单位 MB，比如要想分30GB的区，就写上“30000”，如下图所示。

![20161101_141821_811](../../graphs/photos/20161101_141821_811.jpg)

如果你的硬盘够大，系统分区可以在 100GB 以上；或者使用 128 GB 或 256 GB 左右大小的 SSD 作为系统分区，可以使用全容量，不必划分其他区域，数值不用变，但还是稍微分一下比较保险，哪怕就分两个区（系统单独一个区，软件、文件等单独一个区），万一系统出了无法挽回的问题需要格式化重装，也不至于让所有文件都跟着遭殃。

![20161101_142452_166](../../graphs/photos/20161101_142452_166.jpg)

> 使用GPT分区系统会要求创建 MSR 和 EFI 分区，默认为 128 MB 和 100 MB，用于保留空间和存放引导程序等。

4. 同理按照上述方法划分其他区域，如果使用的是 MBR 分区方式，那么在此处最多只能分出 4 个主分区，但如果用 GPT 分区，数量就不限。如下图所示。

![20161101_142437_607](../../graphs/photos/20161101_142437_607.jpg)

分区后可以在此格式化，也可以直接点“下一步”，系统会自动格式化选中的系统分区；其他未格式化的分区可以在系统安装结束后手动格式化。

![20161101_143201_749](../../graphs/photos/20161101_143201_749.jpg)

> 在此处格式化会给出提示，在确认硬盘中并无文件，或者文件已备份的情况下点击“确定”开始格式化。

实际上只有遵循UEFI规范的主板才能按照efi/boot/bootx64.efi路径启动Windows安装程序，大多数主板都是遵循这一规范的。如果不遵循这一规范，那么你需要手动选择从该文件启动，或者需要在UEFI Shell中以命令的方式启动bootx64.efi。

##### 使用DiskGenius分区软件

这款工具很多资深用户并不陌生，常见于某些国产改版 PE 系统中，当然这些系统中还有其他硬盘分区工具。关于该软件的全部功能用法可以参考[其官网帮助信息](http://www.diskgenius.cn/help/index.php)。

**创建GPT分区**

1. 打开DiskGenius工具后就可以很明显看到当前硬盘分区情况，如下图所示。

   ![20161101_151041_857](../../graphs/photos/20161101_151041_857.jpg)

2.  如果现有分区不满意，可以删掉后重新分，如下图所示。

   ![20161101_151746_879](../../graphs/photos/20161101_151746_879.jpg)

3. 删掉所有已有分区后，重新建立分区会首先提示是否新建 ESP 和 MSR 分区，其中**ESP分区是必须要建立的**（默认100MB即可），否则 Windows 安装程序无法在选择安装位置后开始安装（UEFI + GPT用户直接使用安装盘分区会自动创建所需分区，不会出现影响安装的问题），如下图所示。


![20161101_151814_137](../../graphs/photos/20161101_151814_137.jpg)

4. 建立完上述辅助分区后，就可以正式建立主分区，方法同之前介绍的大同小异，无非就是给出分区大小，如下图所示。

![20161101_155717_591](../../graphs/photos/20161101_155717_591.jpg)

> 如果是为SSD新建分区，要勾选“对齐到下列扇区数的整数倍”，并在“扇区数”下拉菜单中选择“4096”（如上图），以便满足所谓的“4K对齐”条件，这有利于充分发挥SSD的性能优势（**原版系统盘安装程序分区时会自动设置“4K对齐”**，无需手动设置）。

5. 按照上述方法新建分区，完成后要“**保存更改**”，此时程序会询问你是否顺便格式化这些分区，点击“是”即可开始格式化，完成后这些分区就可以使用了，如下图所示。

![装机必学：硬盘分区、格式化通用方法大全](https://img.ithome.com/newsuploadfiles/2016/11/20161101_160447_982.jpg)

**创建MBR分区**

这种分区表和GPT比起来在分区方式上有一定差异，下面具体说明一下：

1. 可直接新建主分区和扩展分区，不会提示MSR等辅助分区建立。

![装机必学：硬盘分区、格式化通用方法大全](https://img.ithome.com/newsuploadfiles/2016/11/20161101_163048_328.jpg)

2. 主分区用于安装系统和引导系统；**扩展分区及下属的逻辑分区用于存储数据**，GPT不具备上述结构。

![装机必学：硬盘分区、格式化通用方法大全](https://img.ithome.com/newsuploadfiles/2016/11/20161101_174631_178.jpg)

3. **主分区最多能建立4个，扩展分区只有一个，下属逻辑分区数量不限，主分区和扩展分区总和不超过4个**，逻辑分区总量必须小于等于扩展分区容量。

![装机必学：硬盘分区、格式化通用方法大全](https://img.ithome.com/newsuploadfiles/2016/11/20161101_163140_269.jpg)

> DiskGenius 软件目前支持NTFS、FAT32、FAT16、exFAT、EXT2、EXT3、EXT4等文件系统的格式化。

##### 安装Linux时

CentOS 7 使用 GRUB2 作为引导加载程序。该引导加载程序是计算机启动后首先运行的程序，负责操作系统的加载及传输控制。GRUB2 可以兼容所有操作系统，同时还可以在不支持的操作系统中使用链式载入将控制权转给其他操作系统。

> 安装双系统时，后安装的引导加载程序会覆盖之前系统的引导加载程序。可以在 Windows 下使用 EasyBCD软件在修改引导加载程序。



#### 添加文件系统并配置分区

安装 CentOS 7 最少需要一个根分区，但建议至少有四个分区：`/`、`/home`、`/boot` 和 `swap`。我们可以根据需要（比如安装Weblogic和Oracle时）创建额外的分区。

CentOS 7 建议在 x86 、AMD 64 和 Intel 64 位系统中至少创建以下分区：

- `/boot` 分区：建议大小至少有 500 MB。挂载到 `/boot` 的分区含有操作系统内核，它可让您的系统引导 CentOS，并提供引导过程中要使用的文件。鉴于多数固件的限制，建议生成一个较小的分区来保存这些文件。多数情况下 500 MB 的 `/boot` 分区就足够了。

- `/ ` 分区：建议大小为 10 GB，这是 `/` 或者根目录所在位置。根目录位于目录结构的顶端。默认情况下所有文件都写入这个分区，除非要写入的路径挂载到了不同分区，比如 `/home` 分区；

  不要将 `/ 目录`与 `/root 目录`混淆。`/root 目录`是 `root 用户`的主目录。

- `/home` 分区：

- `swap` 分区：

**挂载点**

下面这些路径可以作为独立分区的挂载点，你也可以根据实际需要做出其他决定。

**根分区** ：根目录是目录树的顶层，这里是主文件系统挂载和其他文件系统挂靠的地方。所有文件和目录都在根目录 `/` 显示，即使它们实际上存储在其他的物理设备上。根文件系统中的内容应该足以启动、恢复、修复系统。因此 `/` 目录下的特定目录是不能作为独立分区的。

/ 分区或叫根分区是最重要而且必需的，需要最先挂载，其他分区可以被它取代。

警告: 与系统启动相关的特定目录（除了 /boot） 必须 与 / 在同一个分区，或在系统刚进入用户态的时候通过 initramfs 挂载。这些特定的目录包括：/etc 和 /usr [1] 。
因为包括 /usr 目录，根据安装的软件数量，会产生非常明显的增长。15-20 GB 对于大多数用户来说是一个比较合适的取值。如果你打算在这里放一个交换文件（swap file）的话，需要适当调大取值

`/boot`：`/boot` 分区包含内核、ramdisk 镜像以及 boot loader 配置文件和 boot loader stage。它也可以存放内核在执行用户态程序之前所使用的其他数据。`/boot` 在日常系统运行中并不需要，只在启动和内核升级（包括重建initial ramdisk）的时候用到。

如果使用软RAID0（条带化）系统的话，必须有一个独立的 /boot 分区。

Note: 如果使用 UEFI 启动管理器，支持读取 ESP 文件系统，建议将 ESP 挂载到 /boot.
不使用 UEFI 时，/boot 的建议大小时 200 MB，使用 UEFI 时，需要至少 512 MiB 空间。

`/home`：/home目录包含用户定义的配置文件、缓存、应用程序数据和媒体文件。

将/home目录独立使得/分区可以单独重新划分，但是请注意你可以在 /home 没有独立分区的情况下你仍然可以在不修改 /home 目录内容的情况下重装 Arch —— 删除其他顶级目录，然后执行pacstrap。

不能与使用其他发行版的用户共享同一个home目录，因为不同的发行版可能使用不兼容的软件版本和补丁。可以共享媒体目录，或至少使用 /home 分区下的不同home目录。分区大小跟着存储的内容而定。

`/var`：/var 目录存储变量数据例如 spool 目录和文件，管理和登录数据，pacman 的缓存，ABS 树等等。它通常被用作缓存或者日志记录，因此读写频繁。将它独立出来可以避免由于大量日志写入造成的磁盘空间耗尽等问题。

可以将 /usr 设置为只读挂载。所有在操作系统运行过程中（例如安装或软件维护）写入 /usr 的东西放到 /var 下。

注意: /var包含许多小文件。如果将其作为独立分区，在文件系统的选择上需要考虑这一点。
除了其他数据以外，还包括ABS 树和 pacman 缓存。保留缓存的包提供了包降级的能力，因此非常有用。也正因为这样，/var 的大小会随着时间推移而增长。尤其是 pacman 缓存将会随着新软件的安装、系统的升级而增长。在磁盘空间不足的时候，可以安全的清理这个目录。/var 分配 8-12 GB 对于桌面系统来说是比较合适的取值，具体取值取决于安装的软件数量。。

`/tmp` ：默认情况下这个目录已经是一个独立分区，systemd 将其挂载为tmpfs。

`swap`：swap 分区提供能够被作为虚拟内存的内存空间。swap file 也可以实现同样的功能，并且它们之间没有明显的性能区别，但是后者更易于根据需要调整大小。如果没有使用休眠特性的话，swap 分区可以被多个系统共享。查看 Suspend and hibernate 了解如何通过 swap 分区或文件休眠。

在拥有不足 512 MB 内存的机器上，通常为 swap 分区分配2倍内存大小的空间。如果有更大的内存（大于 1024 MB），可以分配较少的空间甚至不需要swap 分区。 Suspend and hibernate 介绍了如何休眠到 swap 分区或文件.

`/data`：可以为需要多用户共享的文件建立一个“data”分区。也可以使用 /home 分区用于这一目的。









硬盘的基本功能就是保存数据并使用命令搜索保存的数据。

> 本附录不一定适用于 AMD 6 4 和 In tel 6 4 以外的架构。但在这里提及的一般原理可能适用。

下图为一个全新的、未使用的磁盘驱动器。

![unused-drive](../../graphs/photos/unused-drive.png)

### 文件系统

要在磁盘驱动器中保存数据，则首先需要格式化该磁盘驱动器。格式化（通常称“ 生成文件系统” ）是向驱动器
中写入信息，在未格式化驱动器中为空白空间建立顺序。下图为一个有文件系统的磁盘驱动器。

![formatted-drive](../../graphs/photos/formatted-drive.png)

如上图所示，文件系统所指派的顺序涉及了一些折衷方案：

- 驱动器中的一**小部分可用空间被用来存储与文件系统有关的数据**，这可以被视作额外部分。
- **文件系统将剩余的空间分成小的一定大小的片段。在 Linux 中，这些片段就是块**。

> 注：没有单一、通用的文件系统。不同的文件系统会彼此不兼容，也就是说，支持某一文件系统（或者相关的文件系统类型）的操作系统可能不支持另外一种文件系统。比如 Windows 不支持 ext4 等日志文件系统，而 Red Hat Enterprise Linux 就支持很多文件系统（包括许多被其他操作系统使用的文件系统），这就使得在不同文件系统之间的数据交换变得容易了。

在磁盘中写入文件系统只是第一步。这个进程的目的实际上是要保存和检索数据。下图显示了写入数据后的磁
盘驱动器：

![used-formatted-drive](../../graphs/photos/used-formatted-drive.png)

某些之前的空数据块现在也存放着数据。然而，只看这个框图，我们不能确认这个磁盘中有多少个文件系统。这有可能是一个，也有可能是多个，因为所有的文件都使用至少一个数据块，而有些文件则使用多个块。另外一个值得注意的地方是，已经被使用的块不一定组成连续的空间；未使用的和已使用的块可以散布排列。这被称作碎片。当尝试调整现存分区的大小时，碎片会对其产生影响。

和大多数与计算机相关的技术一样，与磁盘驱动器刚发明时相比，它已经有了很大的变化。特别是变得越来越
大。不是物理大小变大，而是保存信息的容量增大。同时额外的容量让使用磁盘驱动器的方法发生了根本改
变。

