## Web Service简介
### 什么是Web Service？

根据[W3C关于Web Service的定义](https://www.w3.org/TR/2002/WD-ws-arch-20021114/#whatisws)：

A Web service is a software system identified by a URI, whose public interfaces and bindings are defined and described using XML. Its definition can be discovered by other software systems. These systems may then interact with the Web service in a manner prescribed by its definition, using XML based messages conveyed by internet protocols.

即Web服务是由URI标识的一个软件系统，其公共接口和绑定使用XML来定义和描述。它的定义可以被其他软件系统发现，这些系统可按Web服务定义规定的方式，通过网络协议使用基于XML的消息传递来与Web服务交互。

> 注意：这里的定义并没有假定使用SOAP作为打包格式或处理模型，也没有假定使用WSDL作为服务描述语言。虽然现在（包括未来相当长的一段时间）大量Web服务使用原生HTTP作为数据传输协议，也都使用XML作为数据传输格式，但从长远来看，SOAP和WSDL可能会被其他一些技术替代，比如其他一些机制可以定义成将XML数据聚成到一个包中，其他描述语言（如DAML-S）可以用来替代WSDL。

Web Service也叫XML Web Service，是一种基于现有的开放标准（TCP/IP、HTTP、XML等）的、跨编程语言和跨操作系统的远程调用技术。Web应用程序可以通过Web Service在网络上进行数据交互。所谓跨编程语言，就是说如果服务端程序采用一种编程语言(比如java)编写，而客户端程序则可以采用其他编程语言编写，反之亦然。跨操作系统则是指服务端程序和客户端程序可以分别在不同的操作系统上运行。所谓远程调用，就是一台计算机上的某个程序可以调用到另外一台计算机上某个对象的方法，比如，天气预报系统，淘宝，百度等把自己的系统服务以Web Service的形式暴露出来，让第三方网站和程序可以调用这些服务功能，这样就扩展了自己系统的市场占有率。Web Service就是一个应用程序对外暴露出一个能通过Web进行调用的API，也就是说能用编程的方法通过Web来调用这个应用程序来实现数据交互。我们把调用这个Web Service的应用程序叫做客户端，而把提供这个Web Service的应用程序叫做服务端。

Web Service具有以下易用特性：

- 可重用性。可以在新平台架构上使用旧平台架构的提供的Web服务接口，而不用去重新开发；
- 易用性：Web Service将不同系统的业务逻辑都暴露在网络上，应用可以自由地选择需要的Web服务接口。你只需要在客户端包含特定应用的业务逻辑（要调用的Web服务接口）即可，而不用去重新造轮子。你可以选择自己喜欢的语言，在你喜欢的平台上写Web Service，而不用考虑其他编程语言和平台的具体细节；
- 互操作性。这是Web Service最重要的好处。Web Service打通了不同的编程语言在不同的平台之间通信障碍；
- 松耦合性。每个服务都独立于应用中的其他服务，应用中的部分改动不会影响到其他部分的功能。客户端和服务端也不是紧耦合的，服务端的Web服务接口可以随时间变化，而不用向客户端的功能限制做出妥协；
- 粗粒度。面向对象的技术（如Java）通过独立的方法来对外暴露服务。从头构建一个Java程序需要创建多个细粒度的方法，然后组合成一个粗粒度的服务供客户端或另一个服务消费。暴露的业务接口应该是粗粒度的（仅能访问适当数量的业务逻辑），而Web Service技术提供了一种自然的方式定义粗粒度的服务；
- 既可同步，也可以异步。同步性是指客户端绑定了服务的执行。在同步调用中,客户端在其服务操作完成之前将一直阻塞，处于等待状态。异步操作允许客户端调用服务后可以执行其他功能，在后续某个时间点服务结束后再获得结果。异步功能是松散耦合系统中的一个关键因素。
- 支持远程过程调用（Remote Procedure Calls，即RPCs）。Web Service允许客户端使用基于XML的协议来调用远程对象上的过程（函数和方法），远程过程必须暴露出Web服务支持的输入参数和输出参数。过去几年中，EJB组件 和.NET组件已经成为企业架构的一部分，这两种技术都是通过多种RPC机制来进行分布和访问的。Web Service通过提供自己的服务就能支持RPC，相当于那些传统的组件，或通过将请求转换成一个调用EJB组件或.NET组件；
- 支持文档交换。XML的主要优势之一就是它既可以表示数据，还可以表示复杂的文档，这些文档可以简单地表示当前地址，也可以复杂代表整本书或询价（Request for Quotation，RFQ）。Web服务支持透明地交换文档以便于业务集成。

### Web Service技术
为了实现互操作性，Web Service平台必须提供一套标准的类型系统，用于沟通不同平台、编程语言和组件模型中的不同类型系统。这些标准和协议有：

**XML和XSD**

Web Service采用XML格式封装数据，即在XML文件中说明调用远程服务对象的哪个方法，传递的参数是什么，以及服务对象的返回结果是什么。例如，客户端通过发送XML消息来调用Web service，然后等待相应的XML响应。除了易于建立和易于分析外，XML主要的优点在于它既与平台无关，又与厂商无关。Web Service是用XSD来作为数据类型系统的。当你用不同的编程语言来建立Web Service通信时，为了符合Web Service标准，所有使用的数据类型都必须被转换为XSD类型。如想让它在不同平台和不同软件的不同组件之间传递，还需要用某种东西将它包装起来，这种东西就是一种SOAP协议。

**SOAP**

SOAP即简单对象访问协议（Simple Object Access Protocol），它是一个轻量级的协议，用于在分散的分布式环境交中换结构化信息。它（[SOAP 1.2 Part 1](https://www.w3.org/TR/2004/NOTE-ws-arch-20040211/#soappart1)）定义了一种可扩展的消息框架来打包和交换XML格式的消息，SOAP消息可以使用多种网络协议（如HTTP、SMTP、FTP和RMI/IIOP，或专有的消息协议）进行传输，不过一般都是HTTP。SOAP有三个可选的组件：将应用数据对象编码成为XML对象的规则，XML-envelope为描述信息内容和如何处理内容定义了框架，，执行远程过程调用(RPC)的约定。SOAP可以运行在任何其他传输协议上。例如，你可以使用 SMTP，即因特网电子邮件协议来传递SOAP消息，这可是很有诱惑力的。在传输层之间的头是不同的，但XML有效负载保持相同。

Web Service 希望实现不同的系统之间能够用“软件-软件对话”的方式相互调用，打破了软件应用、网站和各种设备之间的格格不入的状态，实现“基于Web无缝集成”的目标。

**WSDL**

WSDL（Web Services Description Language）即Web Service描述语言　是用机器能阅读的方式提供的一个正式描述文档而基于XML（标准通用标记语言下的一个子集）的语言，用于描述Web Service及其函数、参数和返回值。因为是基于XML的，所以WSDL既是机器可阅读的，又是人可阅读的。

**UDDI**

UDDI（Universal Description, Discovery and Integration）的目的是为电子商务建立标准；UDDI是一套基于Web的、分布式的、为Web Service提供的、信息注册中心的实现标准规范，同时也包含一组使企业能将自身提供的Web Service注册，以使别的企业能够发现的访问协议的实现标准。
调用RPC与消息传递
Web Service本身其实是在实现应用程序间的通信。我们有两种应用程序通信的方法：RPC远程过程调用　和消息传递。使用RPC的时候，客户端的概念是调用服务器上的远程过程，通常方式为实例化一个远程对象并调用其方法和属性。RPC系统试图达到一种位置上的透明性：服务器暴露出远程对象的接口，而客户端就好像在本地使用的这些对象的接口一样，这样就隐藏了底层的信息，客户端也就根本不需要知道对象是在哪台机器上。

XML+XSD：
WebService采用HTTP协议传输数据，除了易于建立和易于分析外，XML主要的优点在于它既是平台无关的，又是厂商无关的。无关性是比技术优越性更重要的：软件厂商是不会选择一个由竞争对手所发明的技术的。

  XML解决了数据表示的问题，但它没有定义一套标准的数据类型，更没有说怎么去扩展这套数据类型。例如，整形数到底代表什么？16位，32位，64位？这些细节对实现互操作性很重要。XML Schema(XSD)就是专门解决这个问题的一套标准。它定义了一套标准的数据类型，并给出了一种语言来扩展这套数据类型。WebService平台就是用XSD来作为其数据类型系统的。当你用某种语言(如VB.NET或C#)来构造一个Web service时，为了符合WebService标准，所有你使用的数据类型都必须被转换为XSD类型。你用的工具可能已经自动帮你完成了这个转换，但你很可能会根据你的需要修改一下转换过程。

SOAP：

Web Service通过HTTP协议发送请求和接收结果时，发送的请求内容和结果内容都采用XML格式封装，并增加了一些特定的HTTP消息头，以说明HTTP消息的内容格式，这些特定的HTTP消息头和XML内容格式就是SOAP协议。SOAP提供了标准的RPC方法来调用Web Service。

  ```
SOAP协议 = HTTP协议 + XML数据格式
  ```

  SOAP协议定义了SOAP消息的格式，SOAP协议是基于HTTP协议的，SOAP也是基于XML和XSD的，XML是SOAP的数据编码方式。打个比喻：HTTP就是普通公路，XML就是中间的绿色隔离带和两边的防护栏，SOAP就是普通公路经过加隔离带和防护栏改造过的高速公路。
WSDL：
   好比我们去商店买东西，首先要知道商店里有什么东西可买，然后再来购买，商家的做法就是张贴广告海报。 WebService也一样，WebService客户端要调用一个WebService服务，首先要有知道这个服务的地址在哪，以及这个服务里有什么方法可以调用，所以，WebService务器端首先要通过一个WSDL文件来说明自己家里有啥服务可以对外调用，服务是什么（服务中有哪些方法，方法接受的参数是什么，返回值是什么），服务的网络地址用哪个url地址表示，服务通过什么方式来调用。
   WSDL(Web Services Description Language)就是这样一个基于XML的语言，用于描述Web Service及其函数、参数和返回值。它是WebService客户端和服务器端都能理解的标准格式。因为是基于XML的，所以WSDL既是机器可阅读的，又是人可阅读的，这将是一个很大的好处。一些最新的开发工具既能根据你的Web service生成WSDL文档，又能导入WSDL文档，生成调用相应WebService的代理类代码。
  WSDL文件保存在Web服务器上，通过一个url地址就可以访问到它。客户端要调用一个WebService服务之前，要知道该服务的WSDL文件的地址。WebService服务提供商可以通过两种方式来暴露它的WSDL文件地址：1.注册到UDDI服务器，以便被人查找；2.直接告诉给客户端调用者。WebService开发
  WebService开发可以分为服务器端开发和客户端开发两个方面：
   服务端开发：把公司内部系统的业务方法发布成WebService服务，供远程合作单位和个人调用。(借助一些WebService框   架可以很轻松地把自己的业务对象发布成WebService服务，Java方面的典型WebService框架包括：axis，xfire，cxf等，java ee服务器通常也支持发布WebService服务，例如JBoss。)
   客户端开发：调用别人发布的WebService服务，大多数人从事的开发都属于这个方面，例如，调用天气预报WebService服务。（使用厂商的WSDL2Java之类的工具生成静态调用的代理类代码；使用厂商提供的客户端编程API类；使用SUN公司早期标准的jax-rpc开发包；使用SUN公司最新标准的jax-ws开发包。当然SUN已被Oracle收购)
   WebService的工作调用原理：对客户端而言，我们给这各类WebService客户端API传递wsdl文件的url地址，这些API就会创建出底层的代理类，我调用这些代理，就可以访问到webservice服务。代理类把客户端的方法调用变成soap格式的请求数据再通过HTTP协议发出去，并把接收到的soap数据变成返回值返回。对服务端而言，各类WebService框架的本质就是一个大大的Servlet，当远程调用客户端给它通过http协议发送过来soap格式的请求数据时，它分析这个数据，就知道要调用哪个java类的哪个方法，于是去查找或创建这个对象，并调用其方法，再把方法返回的结果包装成soap格式的数据，通过http响应消息回给客户端。

 

XML和XSD
可扩展的标记语言（标准通用标记语言下的一个子集）是Web service平台中表示数据的基本格式。除了易于建立和易于分析外，XML主要的优点在于它既是平台无关的，又是厂商无关的。无关性是比技术优越性更重要的：软件厂商是不会选择一个由竞争对手所发明的技术的。
XML解决了数据表示的问题，但它没有定义一套标准的数据类型，更没有说怎么去扩展这套数据类型。例如，整形数到底代表什么？16位，32位，还是64位？这些细节对实现互操作性都是很重要的。W3C制定的XML Schema(XSD)就是专门解决这个问题的一套标准。它定义了一套标准的数据类型，并给出了一种语言来扩展这套数据类型。Web service平台就是用XSD来作为其数据类型系统的。当你用某种语言(如VB. NET或C#)来构造一个Web service时，为了符合Web service标准，所有你使用的数据类型都必须被转换为XSD类型。你用的工具可能已经自动帮你完成了这个转换，但你很可能会根据你的需要修改一下转换过程。
SOAP
Web service建好以后，你或者其他人就会去调用它。简单对象访问协议(SOAP)提供了标准的RPC方法来调用Web service。实际上，SOAP在这里有点用词不当：它意味着下面的Web service是以对象的方式表示的，但事实并不一定如此：你完全可以把你的Web service写成一系列的C函数，并仍然使用SOAP进行调用。SOAP规范定义了SOAP消息的格式，以及怎样通过HTTP协议来使用SOAP。SOAP也是基于XML（标准通用标记语言下的一个子集）和XSD的，XML是SOAP的数据编码方式。
WSDL
你会怎样向别人介绍你的Web service有什么功能，以及每个函数调用时的参数呢？你可能会自己写一套文档，你甚至可能会口头上告诉需要使用你的Web service的人。这些非正式的方法至少都有一个严重的问题：当程序员坐到电脑前，想要使用你的Web service的时候，他们的工具(如Visual Studio)无法给他们提供任何帮助，因为这些工具根本就不了解你的Web service。
解决方法是：用机器能阅读的方式提供一个正式的描述文档。Web service描述语言(WSDL)就是这样一个基于XML（标准通用标记语言下的一个子集）的语言，用于描述Web service及其函数、参数和返回值。WSDL既是机器可阅读的，又是人可阅读的，这将是一个很大的好处。一些最新的开发工具既能根据你的Web service生成WSDL文档，又能导入WSDL文档，生成调用相应Web service的代码。
UDDI
Universal Description, Discovery and Integration
为加速Web Service的推广、加强Web Service的互操作能力而推出的一个计划,基于标准的服务描述和发现的规范(specification)。
以资源共享的方式由多个运作者一起以Web Service的形式运作UDDI商业注册中心。
UDDI计划的核心组件是UDDI商业注册，它使用XML文档来描述企业及其提供的Web Service。
UDDI商业注册提供三种信息：
White Page包含地址、联系方法、已知的企业标识。
Yellow Page包含基于标准分类法的行业类别。
Green Page包含关于该企业所提供的Web Service的技术信息，其形式可能是指向文件或URL的指针，而这些文件或URL是为服务发现机制服务的。
Web Service开发实例
利用WebService实现数据添加
利用WebService实现数据删除
利用WebService给手机发短信[3] 
适合使用Web Service的情况
跨越防火墙；
应用程序集成；
B2B集成；
软件重用
不适合使用Web服务的情况
单机应用程序；
局域网上的同构应用程序









  适用场合
1、跨防火墙通信：
   如果应用程序有成千上万的用户，而且分布在世界各地，那么客户端和服务器之间的通信将是一个棘手的问题。因为客户端和服务器之间通常会有防火墙或者代理服务器。在这种情况下，使用DCOM就不是那么简单，通常也不便于把客户端程序发布到数量如此庞大的每一个用户手中。传统的做法是，选择用浏览器作为客户端，写下一大堆ASP页面，把应用程序的中间层暴露给最终用户。这样做的结果是开发难度大，程序很难维护。如果中间层组件换成WebService的话，就可以从用户界面直接调用中间层组件。从大多数人的经验来看，在一个用户界面和中间层有较多交互的应用程序中，使用WebService这种结构，可以节省花在用户界面编程上20%的开发时间。

2、应用程序集成：

   企业级的应用程序开发者都知道，企业里经常都要把用不同语言写成的、在不同平台上运行的各种程序集成起来，而这种集成将花费很大的开发力量。应用程序经常需要从运行在IBM主机上的程序中获取数据；或者把数据发送到主机或UNIX应用程序中去。即使在同一个平台上，不同软件厂商生产的各种软件也常常需要集成起来。通过WebService，可以很容易的集成不同结构的应用程序。

3、B2B集成：

   用WebService集成应用程序，可以使公司内部的商务处理更加自动化。但当交易跨越供应商和客户、突破公司的界限时会怎么样呢？跨公司的商务交易集成通常叫做B2B集成。WebService是B2B集成成功的关键。通过WebService，公司可以把关键的商务应用“暴露”给指定的供应商和客户。例如，把电子下单系统和电子发票系统“暴露”出来，客户就可以以电子的方式发送订单，供应商则可以以电子的方式发送原料采购发票。当然，这并不是一个新的概念，EDI(电子文档交换)早就是这样了。但是，WebService的实现要比EDI简单得多，而且WebService运行在Internet上，在世界任何地方都可轻易实现，其运行成本就相对较低。不过，WebService并不像EDI那样，是文档交换或B2B集成的完整解决方案。WebService只是B2B集成的一个关键部分，还需要许多其它的部分才能实现集成。

   用WebService来实现B2B集成的最大好处在于可以轻易实现互操作性。只要把商务逻辑“暴露”出来，成为WebService，就可以让任何指定的合作伙伴调用这些商务逻辑，而不管他们的系统在什么平台上运行，使用什么开发语言。这样就大大减少了花在B2B集成上的时间和成本，让许多原本无法承受EDI的中小企业也能实现B2B集成。

4、软件和数据重用：    

      软件重用是一个很大的主题，重用的形式很多，重用的程度有大有小。最基本的形式是源代码模块或者类一级的重用，一种形式是二进制形式的组件重用。采用WebService应用程序可以用标准的方法把功能和数据“暴露”出来，供其它应用程序使用，达到业务级重用。
 不适用场合

1、单机应用程序：

目前，企业和个人还使用着很多桌面应用程序。其中一些只需要与本机上的其它程序通信。在这种情况下，最好就不要用WebService，只要用本地的 API就可以了。COM非常适合于在这种情况下工作，因为它既小又快。运行在同一台服务器上的服务器软件也是这样。最好直接用COM或其它本地的API来进行应用程序间的调用。当然WebService也能用在这些场合，但那样不仅消耗太大，而且不会带来任何好处。

2、局域网的同构应用程序：
